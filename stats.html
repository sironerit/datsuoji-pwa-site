<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ©ç”¨çµ±è¨ˆ - è„±ãŠã˜æ§‹æ–‡</title>
    
    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://pagead2.googlesyndication.com 'unsafe-inline'; connect-src 'self' https://generativelanguage.googleapis.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="è„±ãŠã˜æ§‹æ–‡">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="è„±ãŠã˜æ§‹æ–‡ã®åˆ©ç”¨çµ±è¨ˆãƒ»å®Ÿç¸¾ãƒ‡ãƒ¼ã‚¿ã€‚40-50ä»£ç”·æ€§ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ”¹å–„åŠ¹æœã€åˆ©ç”¨çŠ¶æ³ã€æˆåŠŸäº‹ä¾‹ã‚’è©³ç´°åˆ†æã€‚">
    <meta name="keywords" content="åˆ©ç”¨çµ±è¨ˆ,æ”¹å–„åŠ¹æœ,40ä»£,50ä»£,ç”·æ€§å‘ã‘,ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ”¹å–„,æˆåŠŸäº‹ä¾‹,åˆ†æãƒ‡ãƒ¼ã‚¿">
    
    <!-- Stylesheet -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <h1 class="logo"><img src="icons/icon-192x192.png" alt="è„±ãŠã˜æ§‹æ–‡" class="logo-icon"> è„±ãŠã˜æ§‹æ–‡ - åˆ©ç”¨çµ±è¨ˆ</h1>
            <p class="tagline">40-50ä»£ç”·æ€§å‘ã‘ | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ©ç”¨å®Ÿç¸¾ãƒ»åŠ¹æœåˆ†æ</p>
        </div>
    </header>

    <!-- Left Sidebar -->
    <aside class="left-sidebar">
        <div class="left-sidebar-content">
            <!-- Navigation Menu -->
            <div class="sidebar-section">
                <h3>ğŸ“‹ æ©Ÿèƒ½ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h3>
                <nav class="toc-nav">
                    <a href="./" class="toc-link">ğŸ’¬ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ”¹å–„</a>
                    <a href="./analysis.html" class="toc-link">ğŸ“Š ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸åˆ†æ</a>
                    <a href="./learning.html" class="toc-link">ğŸ“š ä¼šè©±è¡“å­¦ç¿’</a>
                    <a href="./stats.html" class="toc-link active">ğŸ“ˆ åˆ©ç”¨çµ±è¨ˆ</a>
                </nav>
            </div>
            
            <!-- Quick Tips -->
            <div class="sidebar-section">
                <h3>ğŸ’¡ ä»Šæ—¥ã®ãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆ</h3>
                <div class="daily-tip" id="dailyTip">
                    <!-- Dynamic content will be loaded here -->
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content Area with Sidebar -->
    <div class="content-with-sidebar">
        <!-- Main Content -->
        <main class="main">
            <div class="container">
            <!-- Stats Overview Section -->
            <section class="stats-overview-section">
                <div class="stats-header">
                    <h2>ğŸ“ˆ è„±ãŠã˜æ§‹æ–‡ åˆ©ç”¨çµ±è¨ˆãƒ»åˆ†æãƒ‡ãƒ¼ã‚¿</h2>
                    <p class="stats-description">
                        40-50ä»£ç”·æ€§å‘ã‘ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ”¹å–„ã‚µãƒ¼ãƒ“ã‚¹ã®<strong>å…¨ä½“åˆ©ç”¨å®Ÿç¸¾</strong>ã¨
                        <strong>æ”¹å–„åŠ¹æœãƒ‡ãƒ¼ã‚¿</strong>ã‚’ã”è¦§ã„ãŸã ã‘ã¾ã™ã€‚<br>
                        <small style="color: #666;">â€» å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åˆ©ç”¨ãƒ‡ãƒ¼ã‚¿ã‚’é›†è¨ˆã—ãŸçµ±è¨ˆã§ã™</small>
                    </p>
                </div>

                <!-- Main Stats Cards -->
                <div class="main-stats-grid">
                    <div class="stat-card primary-stat">
                        <div class="stat-icon">ğŸ’¬</div>
                        <div class="stat-content">
                            <div class="stat-number" id="totalImprovements">0</div>
                            <div class="stat-label">ç´¯è¨ˆæ”¹å–„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°</div>
                            <div class="stat-trend positive" id="improvementsTrend">æœ¬æ—¥: <span id="todayCount">0</span>å›</div>
                        </div>
                    </div>

                    <div class="stat-card primary-stat">
                        <div class="stat-icon">âœ…</div>
                        <div class="stat-content">
                            <div class="stat-number" id="successRate">---%</div>
                            <div class="stat-label">AIå‡¦ç†æˆåŠŸç‡</div>
                            <div class="stat-trend positive" id="successTrend">ç¨¼åƒä¸­</div>
                        </div>
                    </div>

                    <div class="stat-card primary-stat">
                        <div class="stat-icon">ğŸ“…</div>
                        <div class="stat-content">
                            <div class="stat-number" id="activeDays">0</div>
                            <div class="stat-label">ã‚µãƒ¼ãƒ“ã‚¹ç¨¼åƒæ—¥æ•°</div>
                            <div class="stat-trend positive">ç¶™ç¶šä¸­</div>
                        </div>
                    </div>

                    <div class="stat-card primary-stat">
                        <div class="stat-icon">ğŸš€</div>
                        <div class="stat-content">
                            <div class="stat-number" id="serviceStartMain">2025.07</div>
                            <div class="stat-label">ã‚µãƒ¼ãƒ“ã‚¹é–‹å§‹</div>
                            <div class="stat-trend positive">ç¶™ç¶šæ”¹å–„ä¸­</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Usage Patterns Section -->
            <section class="usage-patterns-section">
                <h3>ğŸ“Š å…¨ä½“åˆ©ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ</h3>
                <div class="patterns-grid">
                    <div class="pattern-card">
                        <h4>â° æ™‚é–“å¸¯åˆ¥åˆ©ç”¨çŠ¶æ³</h4>
                        <div class="time-usage" id="timeUsageChart">
                            <div class="time-slot">
                                <span class="time-label">æœï¼ˆ6-12æ™‚ï¼‰</span>
                                <div class="time-bar" style="height: 0%" id="morningBar"></div>
                                <span class="time-percent" id="morningPercent">0%</span>
                            </div>
                            <div class="time-slot">
                                <span class="time-label">æ˜¼ï¼ˆ12-18æ™‚ï¼‰</span>
                                <div class="time-bar" style="height: 0%" id="afternoonBar"></div>
                                <span class="time-percent" id="afternoonPercent">0%</span>
                            </div>
                            <div class="time-slot">
                                <span class="time-label">å¤œï¼ˆ18-24æ™‚ï¼‰</span>
                                <div class="time-bar" style="height: 0%" id="eveningBar"></div>
                                <span class="time-percent" id="eveningPercent">0%</span>
                            </div>
                            <div class="time-slot">
                                <span class="time-label">æ·±å¤œï¼ˆ0-6æ™‚ï¼‰</span>
                                <div class="time-bar" style="height: 0%" id="nightBar"></div>
                                <span class="time-percent" id="nightPercent">0%</span>
                            </div>
                        </div>
                    </div>

                    <div class="pattern-card">
                        <h4>ğŸ“Š åˆ©ç”¨çµ±è¨ˆæƒ…å ±</h4>
                        <div class="stats-info" id="statsInfo">
                            <div class="info-item">
                                <span class="info-label">ç·ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°</span>
                                <span class="info-value" id="totalRequests">0</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">æˆåŠŸå›æ•°</span>
                                <span class="info-value" id="successCount">0</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">ã‚µãƒ¼ãƒ“ã‚¹é–‹å§‹</span>
                                <span class="info-value" id="serviceStart">---</span>
                            </div>
                        </div>
                    </div>

                    <div class="pattern-card">
                        <h4>ğŸ“ˆ ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³</h4>
                        <div class="system-status" id="systemStatus">
                            <div class="status-item">
                                <span class="status-icon">ğŸŸ¢</span>
                                <span class="status-text">AIå‡¦ç†ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒä¸­</span>
                            </div>
                            <div class="status-item">
                                <span class="status-icon">ğŸ“Š</span>
                                <span class="status-text">çµ±è¨ˆãƒ‡ãƒ¼ã‚¿åé›†ä¸­</span>
                            </div>
                            <div class="status-item">
                                <span class="status-icon">âš¡</span>
                                <span class="status-text">é«˜é€Ÿãƒ¬ã‚¹ãƒãƒ³ã‚¹ç¶­æŒ</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            </div>
        </main>

        <!-- Right Sidebar -->
        <aside class="page-sidebar">
        <div class="sidebar-content">
            <!-- Direct Products Display (No Categories) -->
            <div class="sidebar-section">
                <h3>ğŸ›ï¸ ãŠã™ã™ã‚å•†å“</h3>
                <div class="sidebar-products" id="sidebarProducts">
                    <!-- Products will be loaded by shared-products.js -->
                </div>
            </div>
        </div>
        </aside>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 è„±ãŠã˜æ§‹æ–‡. All rights reserved.</p>
            <div class="footer-links">
                <a href="privacy.html">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a>
                <a href="terms.html">åˆ©ç”¨è¦ç´„</a>
                <a href="contact.html">ãŠå•ã„åˆã‚ã›</a>
            </div>
        </div>
    </footer>

    
    <!-- Daily Tip Script -->
    <script src="daily-tip.js"></script>
    <script src="shared-products.js"></script>
    <script src="app.js"></script>
    <script>
        // å…¨ä½“çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
        async function loadGlobalStats() {
            try {
                const response = await fetch('/.netlify/functions/track-stats', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ action: 'get' })
                });

                if (response.ok) {
                    const stats = await response.json();
                    
                    // åŸºæœ¬çµ±è¨ˆã‚’æ›´æ–°
                    document.getElementById('totalImprovements').textContent = stats.totalImprovements;
                    document.getElementById('todayCount').textContent = stats.todayCount;
                    
                    // æˆåŠŸç‡ã‚’è¡¨ç¤º
                    if (stats.totalRequests > 0) {
                        document.getElementById('successRate').textContent = stats.successRate + '%';
                        document.getElementById('successTrend').textContent = 
                            stats.successRate >= 90 ? 'è‰¯å¥½' : 
                            stats.successRate >= 70 ? 'å®‰å®š' : 'æ”¹å–„ä¸­';
                    }
                    
                    // ç¨¼åƒæ—¥æ•°ã‚’è¡¨ç¤º
                    document.getElementById('activeDays').textContent = stats.activeDays;
                    
                    // æ™‚é–“å¸¯åˆ¥åˆ†æ
                    const maxCount = Math.max(
                        stats.timeSlots.morning, 
                        stats.timeSlots.afternoon, 
                        stats.timeSlots.evening, 
                        stats.timeSlots.night
                    );
                    
                    if (maxCount > 0) {
                        document.getElementById('morningBar').style.height = 
                            (stats.timeSlots.morning / maxCount * 100) + '%';
                        document.getElementById('afternoonBar').style.height = 
                            (stats.timeSlots.afternoon / maxCount * 100) + '%';
                        document.getElementById('eveningBar').style.height = 
                            (stats.timeSlots.evening / maxCount * 100) + '%';
                        document.getElementById('nightBar').style.height = 
                            (stats.timeSlots.night / maxCount * 100) + '%';
                        
                        document.getElementById('morningPercent').textContent = 
                            stats.timeSlotPercents.morning + '%';
                        document.getElementById('afternoonPercent').textContent = 
                            stats.timeSlotPercents.afternoon + '%';
                        document.getElementById('eveningPercent').textContent = 
                            stats.timeSlotPercents.evening + '%';
                        document.getElementById('nightPercent').textContent = 
                            stats.timeSlotPercents.night + '%';
                    }
                    
                    // è¿½åŠ çµ±è¨ˆæƒ…å ±
                    document.getElementById('totalRequests').textContent = stats.totalRequests;
                    document.getElementById('successCount').textContent = 
                        stats.totalRequests - (stats.totalRequests - stats.totalImprovements);
                    
                    // ã‚µãƒ¼ãƒ“ã‚¹é–‹å§‹æ—¥
                    const startDate = new Date(stats.firstUse);
                    document.getElementById('serviceStart').textContent = 
                        startDate.toLocaleDateString('ja-JP', { 
                            year: 'numeric', 
                            month: 'short', 
                            day: 'numeric' 
                        });
                    
                    // ãƒ¡ã‚¤ãƒ³çµ±è¨ˆã‚«ãƒ¼ãƒ‰ã®ã‚µãƒ¼ãƒ“ã‚¹é–‹å§‹ã‚‚æ›´æ–°
                    const startYearMonth = startDate.getFullYear() + '.' + 
                        String(startDate.getMonth() + 1).padStart(2, '0');
                    document.getElementById('serviceStartMain').textContent = startYearMonth;
                    
                    console.log('ğŸ“Š å…¨ä½“çµ±è¨ˆãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºå®Œäº†');
                } else {
                    console.error('çµ±è¨ˆãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—:', response.status);
                }
                
            } catch (error) {
                console.error('çµ±è¨ˆãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                // ã‚¨ãƒ©ãƒ¼æ™‚ã¯åŸºæœ¬çš„ãªè¡¨ç¤ºã‚’ç¶­æŒ
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«çµ±è¨ˆã‚’æ›´æ–°
        document.addEventListener('DOMContentLoaded', loadGlobalStats);
        
        // 30ç§’ã”ã¨ã«çµ±è¨ˆã‚’æ›´æ–°ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§ã‚’ä¿ã¤ï¼‰
        setInterval(loadGlobalStats, 30000);
    </script>
</body>
</html>